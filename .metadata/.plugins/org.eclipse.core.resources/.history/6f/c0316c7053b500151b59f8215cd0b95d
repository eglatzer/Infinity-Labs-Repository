package com.ilad.circularbuffer;

import javax.crypto.IllegalBlockSizeException;

public class ProtectedCircularBuffer<E> extends CircularBuffer<E> {
	private volatile boolean isBusy = false;

	// Constructor
	public ProtectedCircularBuffer(int memCapacity_) throws IllegalBlockSizeException {
		super(memCapacity_);
	}

	// Other Methods
	@Override
	public boolean read(E[] outerBuffer, int memToRead) {
		boolean isSucceed = false;
		while(isBusy) {
			try {
				Thread.sleep(500);
			} catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
		isBusy = true;
		isSucceed = super.read(outerBuffer, memToRead);
		isBusy = false;
		return isSucceed;
	}

	@Override
	public boolean write(E[] outerBuffer, int memToWrite) {
		boolean isSucceed = false;
		while(isBusy) {
			try {
				Thread.sleep(500);
			} catch(InterruptedException e) {
				e.printStackTrace();
			}
		}
		isBusy = true;
		isSucceed = super.write(outerBuffer, memToWrite);
		isBusy = false;
		return isSucceed;
	}
}
